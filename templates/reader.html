<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>danio | Credit Intelligence</title>
    <link rel="stylesheet" href="{{ url_for('static', filename='style.css') }}">
</head>
<body class="app-bg">
    <nav class="nav-shell">
        <div class="nav-content" style="flex-direction: column; align-items: flex-start; padding: 12px 0;">
            <div class="nav-brand-group" style="display: flex; align-items: center; width: 100%;">
                <a href="/workstation" class="brand" style="opacity: 1; text-decoration: none;">danio</a>
            </div>
            <div style="margin-top: 8px;">
                <span class="nav-current" style="font-size: 24px; font-weight: 800; color: var(--danio-navy); display: block;">
                    {% if record %}Credit Intelligence: {{ record.id }}{% else %}New Agreement Normalization{% endif %}
                </span>
            </div>
        </div>
    </nav>

    <main class="container">
        {% if not record %}
        <!-- Ingestion View for New Agreements -->
        <div id="upload-stage" class="card upload-card">
            <div class="upload-icon">ðŸ“„</div>
            <h2>Standardize Credit Agreement</h2>
            <p>Upload a legal PDF to generate a Standardized Loan Object.</p>
            <div class="drop-zone" id="drop-zone">
                <span>Select or Drag Agreement PDF</span>
                <input type="file" id="file-input" hidden accept="application/pdf">
            </div>
        </div>
        {% else %}
        <!-- Verification View for Existing Records -->
        <div class="workstation-grid" style="grid-template-columns: 1.2fr 0.8fr; gap: 30px; align-items: start;">
            <div class="card verification-panel" style="padding: 32px;">
                <div class="panel-head" style="margin-bottom: 32px; border-bottom: 2px solid var(--danio-indigo); display: inline-block; padding-bottom: 4px; text-transform: uppercase; font-size: 11px; letter-spacing: 1px; font-weight: 800; color: var(--danio-indigo);">
                    Harmonized Credit Attributes
                </div>
                
                <div class="attribute-display-grid">
                    <div class="attr-item">
                        <label>Agreement Name</label>
                        <div class="attr-value">{{ record.name }}</div>
                    </div>
                    <div class="attr-item">
                        <label>Facility Type</label>
                        <div class="attr-value">{{ record.type }}</div>
                    </div>
                    <div class="attr-item">
                        <label>Margin (Spread)</label>
                        <div class="attr-value mono-text" style="font-family: monospace; color: var(--danio-indigo);">{{ record.margin }}</div>
                    </div>
                    <div class="attr-item">
                        <label>Jurisdiction</label>
                        <div class="attr-value">{{ record.law }}</div>
                    </div>
                    <div class="attr-item">
                        <label>Maturity Profile</label>
                        <div class="attr-value">{{ record.maturity }}</div>
                    </div>
                    <div class="attr-item">
                        <label>Financial Covenant</label>
                        <div class="attr-value highlight" style="color: #b91c1c; font-weight: 700;">{{ record.leverage_covenant }}</div>
                    </div>
                </div>

                <div class="verification-footer" style="margin-top: 40px; padding-top: 32px; border-top: 1px solid var(--danio-border); display: flex; justify-content: space-between; align-items: center;">
                    <div class="verification-meta">
                        <span style="font-size: 11px; font-weight: 700; text-transform: uppercase; color: var(--danio-slate);">Last Verification</span>
                        <div style="font-size: 14px; font-weight: 600; margin-top: 4px; color: var(--danio-navy);">{{ record.last_verified }}</div>
                    </div>
                    <button class="btn-primary" onclick="window.location.href='/workstation'" style="padding: 12px 24px; font-size: 13px;">Confirm & Return to Ledger</button>
                </div>
            </div>

            <div class="card json-panel" style="background: #0f172a; border-radius: 8px; overflow: hidden; border: 1px solid #1e293b;">
                <div class="panel-head" style="background: #1e293b; color: #94a3b8; padding: 12px 20px; font-size: 10px; font-weight: 800; letter-spacing: 0.5px;">RAW SLO INTEROPERABILITY (JSON)</div>
                <pre id="json-out" style="margin: 0; padding: 20px; font-size: 12px; line-height: 1.6; color: #38bdf8; overflow-x: auto;">{{ record | tojson(indent=4) }}</pre>
            </div>
        </div>
        {% endif %}

        <!-- Dynamic Results Container for new scans -->
        <div id="result-stage" class="workstation-grid" style="display:none;">
            <!-- This part will inherit styles if dynamic extraction is triggered -->
        </div>
    </main>

    <style>
        .attribute-display-grid {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 32px 48px;
        }
        .attr-item label {
            display: block;
            font-size: 11px;
            font-weight: 700;
            text-transform: uppercase;
            letter-spacing: 0.5px;
            color: var(--danio-slate);
            margin-bottom: 8px;
        }
        .attr-value {
            font-size: 15px;
            font-weight: 600;
            color: var(--danio-navy);
            padding: 8px 0;
            border-bottom: 1px solid #f1f5f9;
        }
    </style>

    <script src="{{ url_for('static', filename='script.js') }}"></script>
</body>
</html>
